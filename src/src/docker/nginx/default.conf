server {
  listen 80;
  server_name _;

  root /var/www/html/public;
  index index.php;
  client_max_body_size 32m;

  # App routes
  location / { try_files $uri $uri/ /index.php?$query_string; }

  # PHP-FPM
  location ~ \.php$ {
    include fastcgi_params;
    fastcgi_pass keiba-app:9000;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    fastcgi_read_timeout 300;
  }

  # Livewire は PHP 側
  location ^~ /livewire/ { try_files $uri /index.php?$query_string; }

  # ★ Filament v4 の動的アセットは PHP に渡す（ここが肝）
  location ^~ /fonts/filament/ { try_files $uri /index.php?$query_string; }
  location ^~ /css/filament/   { try_files $uri /index.php?$query_string; }
  location ^~ /js/filament/    { try_files $uri /index.php?$query_string; }

  # 既存の静的（public 直配信）
  location ~* \.(?:css|js|jpg|jpeg|gif|png|svg|ico|woff2?)$ {
    access_log off;
    expires 30d;
    try_files $uri =404;
  }
}